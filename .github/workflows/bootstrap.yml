name: bootstrap
on:
  push:
    branches:
      - main
  pull_request:

defaults:
  run:
    # enable xtrace by default
    # use a login shell, to enable ~/.profile
    # the default default is:
    #      bash --noprofile --norc -eo pipefail {0}
    shell: bash --login -eo pipefail -x {0}
env:
  SHELL: /bin/bash
  PYTHONUNBUFFERED: "1"
  DEBUG: "1"

jobs:
  # unfortunately, macos-13 and macos-14 do not work
  # see https://github.com/getsentry/devenv/pull/83
  bootstrap:
    runs-on: ubuntu-22.04
    timeout-minutes: 60
    env:
      SNTY_DEVENV_BRANCH:
        "${{ github.event.pull_request && github.head_ref || github.ref_name }}"
    steps:
      - uses: actions/checkout@v3
      - name: install
        run: |
          set -u
          : should be able to be run from anywhere:
          repo=$PWD
          mv install-devenv.sh /tmp
          cd /tmp
          ./install-devenv.sh  < $repo/ci/install-devenv-checks.sh
      - name: bootstrap sentry
        run: ./ci/devenv-bootstrap.sh
